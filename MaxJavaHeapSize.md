При работе с одним проектом дважды столкнулась с проблемой настройки JVM max heap size: при запуске JUnit-based тестов и выполнении ресурсоемкой логики Tomcat-based приложения.

Для начала я узнала, что нужно просто добавить JVM ключ типа -Xmx1g. Ок, допустим. Куда?

***

Для JUnit я использовала целую кучу вариантов. Я прописала этот ключ в:
* настройки IntellijIdea:
 * для самого приложения,
 * для компилятора как JVM ключ,
 * для компилятора как размер heap size,
 * для Maven,
* конфигурацию Maven,
* в переменную среды MAVEN_OPTS.
Ни один из вариантов не сработал.

Сработало только укзаание ключа прямо в для Run configuration. На самом деле именно это я сделала сразу после получения OutOfMemoryException, чтобы проверить, сработает ли.

Это было временное решение, которое мне хотелось заменить на более адекватное. В итоге, у меня нет выбора.

***

С Tomcat-based приложением элегантное решение заключалось в настройках самого Tomcat.
В ходе настройки удалось узнать несколько любопытных вещей:
* Настройки JVM для Tomcat канонично держать в скрипт setenv.sh или setenv.bat. Они будут вызваны скриптом catalina.sh или catalina.bat автомагически.
* Записываются эти настройки в виде переменной среды "JAVA_OPTS" или "CATALINA_OPTS", которая будет установлена на время открытой сессии.
* Для указания переменных среды в .sh скриптах используется команда 'export', а в .bat скриптах используется 'set'. Да, это было неочевидно.
* Синтаксис для export и set команд слегка отличается расположением кавычек:
 * export %VAR_NAME% = "%VAR_VALUE%"
 * set "%VAR_NAME% = %VAR_VALUE%"

Последний пункт стал просто вишенкой на торте.

***

В связи с этим у меня осталось несколько открытых вопросов:
* Каково изящное решение проблемы с памятью для JUnit?
* Чем отличаются JAVA_OPTS и CATALINA_OPTS в рамках Tomcat?
* За что?
